<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>How to create web-app with Quartz Scheduler and logging</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
	
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../">Zemian's Blog</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../../index.html">Home</a></li>
            <li><a href="../../../about.html">About</a></li>
            <li><a href="../../../archive.html">Archive</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">	
	<div class="page-header">
		<h1>How to create web-app with Quartz Scheduler and logging</h1>
	</div>

	<p><em>25 August 2013</em></p>

	<p><div class="paragraph">
<p>I sometimes help out users in Quartz Scheduler forums. Once in a while some one would
ask how can he/she setup the Quartz inside a web application. This is actualy a fairly
simple thing to do. The library already comes with a <code>ServletContextListener</code> that
you can use to start a Scheduler. I will show you a simple webapp example here.</p>
</div>
<div class="paragraph">
<p>First create a Maven <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation=
        "http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;quartz-web-demo&lt;/groupId&gt;
    &lt;artifactId&gt;quartz-web-demo&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;version&gt;1.0-SANPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;
            &lt;artifactId&gt;quartz&lt;/artifactId&gt;
            &lt;version&gt;2.2.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to create a <code>src/main/webapp/META-INF/web.xml</code> file.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;web-app version="2.5"
    xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation=
        "http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;

     &lt;context-param&gt;
         &lt;param-name&gt;quartz:config-file&lt;/param-name&gt;
         &lt;param-value&gt;quartz.properties&lt;/param-value&gt;
     &lt;/context-param&gt;
     &lt;context-param&gt;
         &lt;param-name&gt;quartz:shutdown-on-unload&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
     &lt;/context-param&gt;
     &lt;context-param&gt;
         &lt;param-name&gt;quartz:wait-on-shutdown&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
     &lt;/context-param&gt;
     &lt;context-param&gt;
         &lt;param-name&gt;quartz:start-on-load&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
     &lt;/context-param&gt;

     &lt;listener&gt;
         &lt;listener-class&gt;org.quartz.ee.servlet.QuartzInitializerListener&lt;/listener-class&gt;
     &lt;/listener&gt;

 &lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And lastly, you need a <code>src/main/resources/quartz.properties</code> config file for Scheduler.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre># Main Quartz configuration
org.quartz.scheduler.skipUpdateCheck = true
org.quartz.scheduler.instanceName = MyQuartzScheduler
org.quartz.scheduler.jobFactory.class = org.quartz.simpl.SimpleJobFactory
org.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool
org.quartz.threadPool.threadCount = 5</pre>
</div>
</div>
<div class="paragraph">
<p>You may configure
<a href="http://quartz-scheduler.org/documentation/quartz-2.2.x/configuration/">many other things</a> with Quartz,
but above should get you started as in In-Memory scheduler.</p>
</div>
<div class="paragraph">
<p>Now you should able to compile and run it.</p>
</div>
<div class="literalblock">

<div class="content monospaced">
<pre>bash&gt; mvn compile
bash&gt; mvn org.apache.tomcat.maven:tomcat7-maven-plugin:2.1:run -Dmaven.tomcat.port=8081</pre>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_configure_logging_for_quartz_scheduler">How to configure logging for Quartz Scheduler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another frequently asked question is how do they setup logging and see the DEBUG level
messages. The Quartz Schedulers uses SLF4J, so you have many
<a href="http://saltnlight5.blogspot.com/2013/08/how-to-configure-slf4j-with-different.html">loggers options</a>
to choose. I will show you how to setup Log4j for example below.</p>
</div>
<div class="paragraph">
<p>First, add this to your <code>pom.xml</code></p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
            &lt;version&gt;1.7.5&lt;/version&gt;
        &lt;/dependency&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Then add <code>src/main/resources/log4j.properties</code> file to show messages onto STDOUT.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>log4j.rootLogger=INFO, stdout
log4j.logger.org.quartz=DEBUG
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] (%F:%L) - %m%n</pre>
</div>
</div>
<div class="paragraph">
<p>Restart your web application on command line, and now you should see all the DEBUG
level logging messages coming from Quartz library.</p>
</div>
<div class="paragraph">
<p>With everything running, your next question might be asking how do you access the scheduler
from your web application? Well, when the scheduler is created by the servlet context listener,
it is stored inside the web app&#8217;s ServletContext space with
<code>org.quartz.impl.StdSchedulerFactory.KEY</code> key. So you may retrieve it and use it in your
own Servlet like this:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>public class YourServlet extends HttpServlet {
    public init(ServletConfig cfg) {
        String key = "org.quartz.impl.StdSchedulerFactory.KEY";
        ServletContext servletContext = cfg.getServletContext();
        StdSchedulerFactory factory = (StdSchedulerFactory) servletContext.getAttribute(key);
        Scheduler quartzScheduler = factory.getScheduler("MyQuartzScheduler");
        // TODO use quartzScheduler here.
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Now you are on your way to build your next scheduling application!</p>
</div>
<div class="paragraph">
<p>Have fun!</p>
</div>

</div>
</div>


</p>

	<hr />
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2019 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.3</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../js/jquery-1.11.1.min.js"></script>
    <script src="../../../js/bootstrap.min.js"></script>
    <script src="../../../js/prettify.js"></script>
    
  </body>
</html>