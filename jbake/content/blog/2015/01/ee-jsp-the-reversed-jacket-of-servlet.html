title=EE JSP: The Reversed Jacket of Servlet
date=2015-01-25
type=post
tags=jsp
status=published
~~~~~~
Generating HTML from Servlet is only practical if you have small amount of pages, or needed fine control of the content you are generating, (binary PDF etc). For most application, the output is going to be HTML, and we need a better way to do this; and that's where the JSP (Java Server Pages) comes in.<br />
<br />
With JSP, you write and focus on the HTML content in a file; then only when you needed dynamic or condition logic in between the content, you would insert the Java code, which called the Scriptlet. When the application server process the JSP page, it will automatically generate a Servlet class that write these JSP file's content out (as you would programatically writing it using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PrintWriter </span>as shown in my previous posts). Wherever you have the Scriptlet in JSP, it will be inlined in the generated Servlet class. The generated jsp servlet classes are all managed, compiled and deployed by the application server within your application automatically. In short, the JSP is nothing more than the reverse jacket of the Servlet.<br />
<br />
Here is a simple example of JSP that print Hello World and a server timestamp.<br />
<br />
<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Hello World!&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Page served on &lt;%= new java.util.Date()%&gt;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br />&lt;/html&gt;</span><br />
<br />
Simply save this as text file named <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">hello.jsp</span> inside your <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">src/main/webapp</span> maven based folder, and it will be runnable within your NetBeans IDE. For JSP, you do not need to configure URL mapping as in Serlvet, and it's directly accessable from your context path. For example, above should display in your browser by http://localhost:8080/hello.jsp URL.<br />
<br />
Notice the example also show how you can embed Java code. You can place a method or object inside <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%= %&gt;</span> scriptlet, and it will use the resulted object's <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">toString()</span> method output to concatenate to the HTML outside the scriptlet tag. You can also define new methods using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%! %&gt;</span> scriptlet tag, or execute any code that does not generate output using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;% %&gt;</span> scriptlets. Note that you can add comments in JSP between <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%-- --%&gt;</span> scriptlet as well.<br />
<br />
JSP also allows you to insert "Page Directives" to control how the JSP container render the result. For example, you can change the result content type by insert this on top of the page<br />
<br />
<pre class="prettyprint prettyprinted"><span class="pun">&lt;%@</span><span class="pln"> page contentType</span><span class="pun">=</span><span class="str">"text/txt"</span><span class="pln"> %&gt;</span><span class="pln"></span></pre>
<br />
Another often used page directive is import Java package so you don't need to prefix it on each Java statement line.<br />
<br />
<pre class="prettyprint prettyprinted"><span class="pun">&lt;%@</span><span class="pln"> page imporet</span><span class="pun">=</span><span class="str">"java.util.*"</span><span class="pln"> %&gt;</span></pre>
<pre class="prettyprint prettyprinted"><span class="pln">&nbsp;</span></pre>
<pre class="prettyprint prettyprinted"><span class="pln">...</span></pre>
<pre class="prettyprint prettyprinted"></pre>
<pre class="prettyprint prettyprinted"></pre>
<pre class="prettyprint prettyprinted"></pre>
<pre class="prettyprint prettyprinted"><span class="pln"></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;</span></pre>
<pre class="prettyprint prettyprinted"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;p&gt;Page served on &lt;%= new Date()%&gt;&lt;/p&gt;</span></pre>
<pre class="prettyprint prettyprinted"><span class="pln"></span></pre>
<br />
There are many more directives you can use. Checkout the JSP spec doc for more details.<br />
<br />
Besides inserting your own Java code, JSP also predefined some variables you may access directly without declaring them. Here is an example that displays most of these built-in implicit variables.<br />
<br />
<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h1&gt;JSP Examples&lt;/h1&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Implicit Variables&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;Name&lt;/td&gt;&lt;td&gt;Instance&lt;/td&gt;&lt;td&gt;Example&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;applicationScope&lt;/td&gt;&lt;td&gt;${applicationScope}&lt;/td&gt;&lt;td&gt;${applicationScope['myAppName']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;sessionSope&lt;/td&gt;&lt;td&gt;${sessionSope}&lt;/td&gt;&lt;td&gt;${sessionSope['loginSession']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;pageScope&lt;/td&gt;&lt;td&gt;${pageScope}&lt;/td&gt;&lt;td&gt;${pageScope['javax.servlet.jsp.jspConfig']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;requestScope&lt;/td&gt;&lt;td&gt;${requestScope}&lt;/td&gt;&lt;td&gt;${requestScope['foo']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;param&lt;/td&gt;&lt;td&gt;${param}&lt;/td&gt;&lt;td&gt;${param['query']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;header&lt;/td&gt;&lt;td&gt;${header}&lt;/td&gt;&lt;td&gt;${header['user-agent']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;cookie&lt;/td&gt;&lt;td&gt;${cookie}&lt;/td&gt;&lt;td&gt;${cookie['JSESSIONID']}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;pageContext&lt;/td&gt;&lt;td&gt;${pageContext}&lt;/td&gt;&lt;td&gt;${pageContext.request.contextPath}&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Page served on &lt;%= new java.util.Date()%&gt;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br />&lt;/html&gt;</span>&nbsp; <br />
In above example, I accessed the implicit variables using the JSP Expression Language (EL) syntax rather than the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%= %&gt;</span> scriptlet. The EL is more compact and easier to read, however it only can read variable that existed in any of the request, session or application scopes. The EL uses DOT notation to access fields or even nested fields from the object variable; assuming the fields have corresponding getter methods that is. EL can also access map with "myMap[key]" format, or a list with "myList[index]" syntax. Most of these implicit variables can be access as a Map object, and they exposed mainly from the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ServletHttpRequest </span>object on the request, as you would from your own Servlet class.<br />
<br />
JSP can be seen as a template language in the web application. It helps generate the "VIEW" part of the application. It let you or the authoring in your team to focus on the HTML and look and feel of the content. It can help building larger web application much easier. Be careful about using excessive and complex logic Java code inside your JSP files though, as it will make it harder to debug and read; especially if you have a Java statement that throws an exception. The line number from the stacktrace would be harder to track and match to your Scriptlet code. Also imagine if you start to have JavaScript code inside JSP files, then it can get really messy. Better to keep these in separate files. If you must embed Java code in JSP, try to wrap it in a single line of Java invocation call. Better yet, try to process request using Servlet code, and generate all the data you need to display in JSP by insert them into the request scope space, and then forward to a JSP file for rendering. With this pattern, you can actually limit usage of scriptlet 
in JSP, and only use EL and JSP tags.<br />
<br />
You can find above code in my <a href="https://github.com/saltnlight5/java-ee6-examples/tree/master/jsp-example">jsp-example</a> in GitHub.<br />
<br />