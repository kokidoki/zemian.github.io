title=Setup MySQL DataSource on WLS
date=2015-10-04
type=post
tags=weblogic, mysql
status=published
~~~~~~
Here is a WLST script to setup MySQL DataSource in WebLogic server after you have created a domain. The script will also assign this DataSource to one or more servers you pass in at the end of arguments.<br />
<br />
<span style="font-family: Courier New, Courier, monospace;"># Update an existing domain to setup a DataSource and assign it to servers</span><br />
<span style="font-family: Courier New, Courier, monospace;"># Example</span><br />
<span style="font-family: Courier New, Courier, monospace;"># &nbsp; wlst.cmd setupDataSource.py C:\data\wls11g_domains\dev MYTESTDB jdbc/MYTESTDB com.mysql.jdbc.Driver jdbc:mysql://localhost/mytestdb test test123 AdminServer</span><br />
<br />
<span style="font-family: Courier New, Courier, monospace;">import os, sys, os.path</span><br />
<span style="font-family: Courier New, Courier, monospace;">(domain_home, ds_name, jndi_name, driver_name, url, user, password) = sys.argv[1:8]</span><br />
<span style="font-family: Courier New, Courier, monospace;">servers = sys.argv[8:]</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">domain_home = os.path.abspath(domain_home)</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">readDomain(domain_home)</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">print("Setting up WLS DataSource: %s" % ds_name)</span><br />
<span style="font-family: Courier New, Courier, monospace;">create(ds_name, 'JDBCSystemResource')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('/JDBCSystemResource/%s/JdbcResource/%s' %(ds_name, ds_name))</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('myJdbcDriverParams','JDBCDriverParams')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('JDBCDriverParams/NO_NAME_0')</span><br />
<span style="font-family: Courier New, Courier, monospace;">set('DriverName',driver_name)</span><br />
<span style="font-family: Courier New, Courier, monospace;">set('URL', url)</span><br />
<span style="font-family: Courier New, Courier, monospace;">set('PasswordEncrypted', password)</span><br />
<span style="font-family: Courier New, Courier, monospace;">set('UseXADataSourceInterface', 'false')</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('myProps','Properties')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('Properties/NO_NAME_0')</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('user', 'Property')</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('characterEncoding', 'Property')</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('connectionCollation', 'Property')</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('useUnicode', 'Property')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('Property/user')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cmo.setValue(user)</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('../characterEncoding')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cmo.setValue('utf-8')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('../connectionCollation')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cmo.setValue('utf8_general_ci')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('../useUnicode')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cmo.setValue('true')</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">cd('/JDBCSystemResource/%s/JdbcResource/%s' %(ds_name, ds_name))</span><br />
<span style="font-family: Courier New, Courier, monospace;">create('myJdbcDataSourceParams','JDBCDataSourceParams')</span><br />
<span style="font-family: Courier New, Courier, monospace;">cd('JDBCDataSourceParams/NO_NAME_0')</span><br />
<span style="font-family: Courier New, Courier, monospace;">set('JNDIName', java.lang.String(jndi_name))</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">cd('/')</span><br />
<span style="font-family: Courier New, Courier, monospace;">for server in servers:</span><br />
<span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>print("Assigning DS to server: %s" % server)</span><br />
<span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>assign('JDBCSystemResource', ds_name, 'Target', server)</span><br />
<span style="font-family: Courier New, Courier, monospace;"><br /></span>
<span style="font-family: Courier New, Courier, monospace;">updateDomain()</span><br />
<span style="font-family: Courier New, Courier, monospace;">exit()</span><br />
<div>
<br /></div>
