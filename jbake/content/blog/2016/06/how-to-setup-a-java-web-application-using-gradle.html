title=How to setup a Java web application using Gradle
date=2016-06-14
type=post
tags=gradle
status=published
~~~~~~
For basic java and Gradle, it's really simple. All you need is one line in <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">build.gradle</span>&nbsp;file and you can start compiling Java source under <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">src/main/java</span> folder.<br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">apply plugin: 'java'</span><br />
<br />
But to setup a useful web application, &nbsp;you would need little more. Here I have another example of Gradle 2.7 script file for building a Java web application. I also have noted few things I have discovered in the comments.<br />
<br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># A Java web app project</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># There should be a src/main/webapp as web content directory</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">apply plugin: 'war'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">apply plugin: 'jetty'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Change jetty default port from 8080</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">httpPort = 9000</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># A repository must be given to fetch dependencies below.</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">repositories {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; mavenCentral()</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Library dependencies</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">dependencies {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; // JDK lang support</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; // Ouch! Gradle does not support 'provided' scope! Let's use compile for now.</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; //provided 'org.projectlombok:lombok:1.16.6'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;&nbsp;compile&nbsp;</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">'org.projectlombok:lombok:1.16.6'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; // Testing</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; testCompile 'junit:junit:4.12',</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; 'org.hamcrest:hamcrest-library:1.3'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; // Database</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; runtime 'mysql:mysql-connector-java:5.1.37' &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; // Scripting</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; //runtime 'org.codehaus.groovy:groovy-all:2.4.5'</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; /*</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; NOTE: Error if you include groovy with gradle+jetty!!!</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;java.lang.ExceptionInInitializerError:</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>groovy.lang.GroovyRuntimeException: Conflicting module versions. Module [groovy-all is loaded in version 2.3.10 and you are trying to load version 2.4.5</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp;// Verify your groovy version using the following:</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>import javax.script.*</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>out.println(new ScriptEngineManager().getEngineFactories())</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>out.println(org.codehaus.groovy.jsr223.GroovyScriptEngineFactory.class.getProtectionDomain().getCodeSource().getLocation())</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; */&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: inherit;">I also have this JSP in</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">src/main/webapp/script.jsp </span><span style="font-family: inherit;">folder</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;%@ page import="javax.script.*, java.io.*" %&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;%</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">// Initialize parameters</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">String engineName = request.getParameter("engine");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">if (engineName == null) engineName = "Groovy";</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">String code = request.getParameter("code");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">if (code == null) code = "";</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">%&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;!-- form: Script input code --&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;h1&gt;Scripting&lt;/h1&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;form method="POST"&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;textarea name="code" cols="120" rows="25"&gt;&lt;%= code %&gt;&lt;/textarea&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;p/&gt;&lt;input type="submit" value="Submit"/&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;/form&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;pre&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;%</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">if (request.getMethod().equals("POST")) {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>// Process form and evaluate script code</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>ScriptEngine se = new ScriptEngineManager().getEngineByName(engineName);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>if (se == null) {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>out.println("ERROR: " + engineName + " engine not found! Use 'engine' parameter to change it.");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>} else {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>try {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>Bindings b = se.createBindings();</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>b.put("request", request);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>b.put("out", out);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>Object result = se.eval(code, b);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>out.println(engineName + " script result:");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>out.println("" + result);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>} catch (Exception e) {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>out.println("ERROR: " + engineName + " script failed to evaluate!");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">   </span>e.printStackTrace(new PrintWriter(out));</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">%&gt;</span><br />
<br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;/pre&gt;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: inherit;">With this</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> script.jsp</span><span style="font-family: inherit;">, you can write something like this to test out your db connection.</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">// Groovy script:</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">import java.sql*</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">conn = DriverManager.getConnection('jdbc:mysql://localhost/test', 'dev', 'dev123')</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">out.println("conn=" + conn)</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">conn.close()</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: inherit;">And just for fun, I have created a data class using ProjectLombok generator</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;in src/main/java/myjava/MyData.java</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">package myjava;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">import java.util.*;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">@lombok.Data</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">public class MyData {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>private Integer id;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>private String name;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>private Date createdDate;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>private List&lt;MyData&gt; dataList;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>private Map&lt;String, MyData&gt; dataMap;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: inherit;">I also have a unit test in</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> src/test/java/myjava/MyDataTest.java</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">package myjava;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">import org.junit.Test;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">import static org.junit.Assert.assertThat;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">import static org.hamcrest.Matchers.*;</span><br />
<br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">public class MyDataTest {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>@Test</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>public void tesGeneratedGetterSettersAndToString() {</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>MyData d = new MyData();</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>d.setId(12345);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>d.setName("foo");</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>assertThat(d.getId(), is(12345));</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>assertThat(d.getName(), is("foo"));</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>assertThat(d.toString(), is("MyData(id=12345, name=foo, createdDate=null, dataList=null, dataMap=null)"));</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
To compile code, type command:&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">gradle compileJava</span><br />
To run test, type command:&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">gradle test</span>(A nice feature of Gradle is that it auto generate test reports! Look for them in your <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">build/reports</span> folder.)<br />
To run web app, type command:&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">gradle jettyRun</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>