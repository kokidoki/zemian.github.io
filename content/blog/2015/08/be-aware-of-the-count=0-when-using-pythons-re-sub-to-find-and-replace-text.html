title=Be aware of the count=0 when using Python's re.sub() to find and replace text
date=2015-08-23
type=post
tags=python
status=published
~~~~~~
I have an xml file and I want to remove a whole section of element without actually parsing the XML file. I wrote an Python script to do just that. I first tested it out like this:<br />
<br />
<span style="font-family: Courier New, Courier, monospace;">import re</span><br />
<span style="font-family: Courier New, Courier, monospace;">input_text = open('my.xml').read()</span><br />
<span style="font-family: Courier New, Courier, monospace;">result = re.findall(r'&lt;library-ref&gt;.*&lt;/library-ref&gt;', input_text, re.S)</span><br />
<span style="font-family: Courier New, Courier, monospace;">print(result)</span><br />
<br />
<br />
The result IS what I wanted, so I thought I can quickly replace it with something like this:<br />
<br />
<span style="font-family: Courier New, Courier, monospace;">result = re.sub(r'&lt;library-ref&gt;.*&lt;/library-ref&gt;', '', input_text, re.S)</span><br />
<br />
And to my surprise this does not work. It took me a while to notice that I mis used the method according to the documentation, which has this signature:<br />
<br />
<span style="font-family: Courier New, Courier, monospace;">re.sub(pattern, repl, string, count=0, flags=0)</span><br />
<br />
At first glace, I thought that count is already default to zero and I do not need to set it, but because that is a positional parameter, you must include it! So you suppose to call it explicit like this:<br />
<br />
<span style="font-family: Courier New, Courier, monospace;">result = re.sub(r'&lt;library-ref&gt;.*&lt;/library-ref&gt;', '', input_text, 0, re.S)</span><br />
<br />
Or, if you like, you can use the "flags" parameter name explicitly without the odd looking zero.<br />
<br />
<span style="font-family: Courier New, Courier, monospace;">result = re.sub(r'&lt;library-ref&gt;.*&lt;/library-ref&gt;', '', input_text, flags=re.S)</span><br />
<br />
So here is an example of flexible dynamic typing of optional parameters can bite if you are not careful.<br />
<div>
<br /></div>
