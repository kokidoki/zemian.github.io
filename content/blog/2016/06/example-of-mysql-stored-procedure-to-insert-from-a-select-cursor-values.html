title=Example of MySQL stored procedure to INSERT from a SELECT cursor values
date=2016-06-26
type=post
tags=mysql
status=published
~~~~~~
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DELIMITER //</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DROP PROCEDURE IF EXISTS proc_hotfix1 //</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">CREATE PROCEDURE proc_hotfix1()</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">BEGIN</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; DECLARE flag INT DEFAULT 0;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; DECLARE CID VARCHAR(64);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; DECLARE LOGIN VARCHAR(1000);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; DECLARE cur1 CURSOR FOR&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; SELECT CID, LOGIN FROM MYUSER WHERE LOGIN LIKE 'bad.guy%';</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; OPEN cur1;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; REPEAT</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; FETCH cur1 INTO CID, LOGIN;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; INSERT INTO hotfix1(id,f1) VALUES (CID, LOGIN);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; UNTIL flag</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; END REPEAT;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; CLOSE cur1;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">END //</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DELIMITER ;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DROP TABLE IF EXISTS hotfix1;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">CREATE TABLE hotfix1(</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; id VARCHAR(64) KEY</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; ,f1 VARCHAR(1000)</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; ,f2 VARCHAR(1000)</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; ,f3 VARCHAR(1000)</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">);</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">CALL proc_hotfix1();</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">SELECT COUNT(*) FROM hotfix1;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">SELECT * FROM hotfix1;</span>