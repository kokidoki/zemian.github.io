title=EE JSP: Generating Dynamic Content with Custom Tag Libraries
date=2015-02-02
type=post
tags=jsp, tag
status=published
~~~~~~
When developing View layer in a web application, you want to try not to duplicate content in JSP files as much as possible. The JSP spec API allows you to reduce this duplication by using tag libraries. A custom JSP tag is a user defined xml tag element that you can insert into JSP file to replace with some dynamic content.<br />
<br />
Here is an simple <a href="https://github.com/saltnlight5/java-ee6-examples/blob/master/jsp-example/">jsp-example</a>&nbsp;using a custom JSP tag that insert a server time stamp value:<br />
<br />
<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%@ taglib prefix="myapp" tagdir="/WEB-INF/myappTags" %&gt;<br />&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h1&gt;Hello World!&lt;/h1&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Page served on &lt;myapp:serverTime pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br />&lt;/html&gt;</span><br />
<br />
JSP tags can also allow you to pass in parameters as attributes of the tag. In the example above&nbsp;<span style="font-family: 'Courier New', Courier, monospace;">&lt;myapp:serverTime&gt; </span>tag uses a custom pattern attribute to control how the date string should be formatted.<br />
<br />
JSP tags can also be nested with sub tags, or any HTML content elements. The nested JSP tags can provide a way for you to conditionally render the enclosed content. Using tag to render conditional content is more verbose due to XML structure, but it eliminates the use of direct Scriptlet code in JSP.<br />
<br />
There are two ways you can create custom JSP tags. The first method is to implement the tag using pure Java code and then register it with a XML taglib definition file. I will skip this method for now and show you another easier way.<br />
<br />
The second method uses "Tag Files" that are similar to JSP pages to construct a tag (remember that JSP tag is nothing more than just a placeholder for some content!). I am going to show you how the second method is done for above example. First create a <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">serverTime.tag</span> file under your <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">src/main/webapp/WEB-INF/tags/myapp</span> project folder.<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span></span><br />
<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br />&lt;%@ attribute name="pattern" required="true" %&gt;</span></span><br />
<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;%@ tag import="java.util.Date, java.text.SimpleDateFormat" %&gt;<br />&lt;%= new SimpleDateFormat(pattern).format(new Date()) %&gt;</span><br />
<br />
The Tag File implementation depends on simple convention of file naming and location. Note that the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">src/main/webapp/WEB-INF/tags </span>directory is a required path. Inside this folder,&nbsp; you may create any sub folder you want to organize the tag files. In our case, it's the <span style="font-family: Courier New, Courier, monospace;">myapp</span> directory. A Tag File can be just like any JSP file you would normally create, except the tag directives are little different. You can see the JSP spec for a complete list of them. Whatever you output from the Tag File, it will be inserted and replaced the caller of the tag. Notice how I use the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">pattern </span>attribute parameter to allow user change the date pattern, and it's available in the Tag File inside the Scriptlet Java code as variable.<br />
<br />
Since you can write Tag Files just as you would with JSP, I will again caution the excessive use of Java code Scriptlet even inside Tag Files. If you must call Java code, try to wrap the code and replace by single line call, or write the Tag implementation with pure Java code; especially if you have very complex business logic involve. This would bring debugging much easier on your code and to maintain.<br />
<br />
JSP tags provide a powerful way to construct your View layer in the web application. It helps you reuse code or content, and generating a specific piece of response.