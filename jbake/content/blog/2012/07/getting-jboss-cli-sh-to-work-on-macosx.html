title=Getting jboss-cli.sh to work on MacOSX
date=2012-07-28
type=post
tags=jboss
status=published
~~~~~~
If you use MacOSX and JBossAS, then you might have encountered this problem when using the jboss-client.sh tool:<br />
<br />
<br />
<div>
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">$ bin/jboss-cli.sh&nbsp;</span></div>
<div>
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.</span></div>
<div>
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">[disconnected /] connect</span></div>
<span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: xx-small;">The controller is not available at localhost:9999</span><br />
<div>
<br /></div>
<div>
Or you will get this:</div>
<div>
<br /></div>
<div>
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">$ bin/jboss-cli.sh --connect</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">org.jboss.as.cli.CliInitializationException: Failed to connect to the controller</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.impl.CliLauncher.initCommandContext(CliLauncher.java:229)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.impl.CliLauncher.main(CliLauncher.java:207)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.CommandLineMain.main(CommandLineMain.java:34)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at java.lang.reflect.Method.invoke(Method.java:601)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.modules.Module.run(Module.java:260)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.modules.Main.main(Main.java:291)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;">Caused by: org.jboss.as.cli.CommandLineException: The controller is not available at localhost:9999</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.impl.CommandContextImpl.connectController(CommandContextImpl.java:639)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.impl.CommandContextImpl.connectController(CommandContextImpl.java:613)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>at org.jboss.as.cli.impl.CliLauncher.initCommandContext(CliLauncher.java:227)</span><br />
<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>... 8 more</span></div>
<div>
<br /></div>
<div>
It turns out this is bug on the JDK 1.7 that only appears on MacOSX JDK7! To be exact, I have the following:&nbsp;<span style="background-color: white; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; text-align: left;">MacOSX 10.7.4 with JDK 1.7.0_05 and JBossAS 7.1.1.Final.</span></div>
<div>
<span style="background-color: white; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; text-align: left;"><br /></span></div>
<div>
This problem has already been discovered by these posts:</div>
<div>
<a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7159361">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7159361</a></div>
<div>
<a href="https://community.jboss.org/message/750861#750861">https://community.jboss.org/message/750861#750861</a></div>
<div>
<br /></div>
<div>
Except after ready through all, and I can't still get it to work because no one listed a clear steps by steps solution. So I re-summarize it again. You need to use that bug's report workaround solution on both the server and client!</div>
<div>
<br /></div>
<div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; list-style: none; outline: 0px; padding: 0px; text-align: left;">
Start the server:&nbsp;</div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; height: 8pt; list-style: none; min-height: 8pt; outline: 0px; padding: 0px; text-align: left;">
<br /></div>
<pre class="jive-pre" style="background-image: none; background-repeat: repeat repeat; border-collapse: collapse; border-color: rgb(238, 238, 238) rgb(238, 238, 238) rgb(238, 238, 238) rgb(204, 204, 204); border-spacing: 0px; border-style: solid; border-width: 1px 1px 1px 2px; color: #333333; font-family: 'Droid Sans Mono', monospace !important; font-size: 11.818181991577148px; list-style: none; margin: 10px 20px; outline: 0px; overflow: auto; padding: 10px; text-align: left; width: auto;"><code class="jive-code" style="background-color: transparent; border-collapse: collapse; border-spacing: 0px; border: 0px; font-family: 'Droid Sans Mono', monospace !important; font-size: 1em; list-style: none; margin: 0px; outline: 0px; padding: 0px;">$ bin/standalone.sh -Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.KQueueSelectorProvider 
... 
18:37:22,555 INFO&nbsp; [org.jboss.as] (Controller Boot Thread) JBAS015874: JBoss AS 7.1.1.Final "Brontes" started in 1686ms - Started 133 of 208 services (74 services are passive or on-demand)
</code></pre>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; height: 8pt; list-style: none; min-height: 8pt; outline: 0px; padding: 0px; text-align: left;">
<br /></div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; list-style: none; outline: 0px; padding: 0px; text-align: left;">
And on separate terminal, run the CLI:</div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; height: 8pt; list-style: none; min-height: 8pt; outline: 0px; padding: 0px; text-align: left;">
<br /></div>
<pre class="jive-pre" style="background-image: none; background-repeat: repeat repeat; border-collapse: collapse; border-color: rgb(238, 238, 238) rgb(238, 238, 238) rgb(238, 238, 238) rgb(204, 204, 204); border-spacing: 0px; border-style: solid; border-width: 1px 1px 1px 2px; color: #333333; font-family: 'Droid Sans Mono', monospace !important; font-size: 11.818181991577148px; list-style: none; margin: 10px 20px; outline: 0px; overflow: auto; padding: 10px; text-align: left; width: auto;"><code class="jive-code" style="background-color: transparent; border-collapse: collapse; border-spacing: 0px; border: 0px; font-family: 'Droid Sans Mono', monospace !important; font-size: 1em; list-style: none; margin: 0px; outline: 0px; padding: 0px;">$JAVA_OPTS="-Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.KQueueSelectorProvider" bin/jboss-cli.sh --connect 
[standalone@localhost:9999 /] 
</code></pre>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; height: 8pt; list-style: none; min-height: 8pt; outline: 0px; padding: 0px; text-align: left;">
<br /></div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; list-style: none; outline: 0px; padding: 0px; text-align: left;">
<span style="color: black; font-family: Times; font-size: small; text-align: -webkit-auto;">There, now we may continue to explore the cool JBossAS on the fancy OS.</span></div>
<div style="border-collapse: collapse; border-spacing: 0px; border: 0px; color: #555555; font-family: 'Lucida Sans', 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif; font-size: 11.818181991577148px; list-style: none; outline: 0px; padding: 0px; text-align: left;">
<span style="color: black; font-family: Times; font-size: small; text-align: -webkit-auto;"><br /></span></div>
</div>